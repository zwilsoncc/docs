import Doc from '~/components/layout/docs'
import Snippet from '~/components/snippet'
import Caption from '~/components/text/caption'
import Note from '~/components/text/note'
import Card from '~/components/card'
import { Image } from '~/components/media'
import { InlineCode } from '~/components/text/code'

export const meta = {
  title: 'Custom Domains',
  description: 'How to add and use a custom domain with your project.',
  editUrl: 'pages/docs/v2/custom-domains.mdx',
  lastEdited: '2019-12-20T03:02:30.000Z'
}

By default, all deployments are assigned a `.now.sh` suffixed domain.

This domain can be replaced with a **Custom Domain** of your choice. This Custom Domain can be purchased with ZEIT or a third-party.

In this document, adding a domain to your ZEIT Now [projects](/docs/v2/platform/projects/) is explained in detail.

## Adding a Domain

If you don't own a domain yet, you can [purchase it with ZEIT](https://zeit.co/domains). Then, once you own a domain, adding it to a project is very straightforward:

### Step 1: Selecting Your Project

On the [dashboard](https://zeit.co/dashboard), pick the project to which you would like to assign your domain:

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/select-project.png`}
  width={1080 / 2}
  height={320 / 2}
  shadow
/>
<Caption>Selecting the project from the ZEIT Dashboard.</Caption>

### Step 2: Navigating to Domain Settings

Once you have selected the project of your choice, click on the **Domains** item in the menubar:

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/select-domains.png`}
  width={728 / 2}
  height={274 / 2}
  shadow
/>
<Caption>Selecting the <b>Domains</b> tab from the Project Overview page.</Caption>

### Step 3: Entering Your Chosen Domain

From the **Project Domains** page, enter the domain you wish to add to the project:

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/enter-domain.png`}
  width={1350 / 2}
  height={447 / 2}
  shadow
/>
<Caption>Entering a domain for the project from the Project Domains page.</Caption>

### Step 4: Configuring the Domain

Once the domain has been added, you will be presented with different methods for configuring it, depending on whether it is an **apex domain** (zeit.co) or **subdomain** (docs.zeit.co).

Both domain types can be configured using the **Nameservers** method, however **apex domains** also allow for verification via the **ANAME** record, whilst **subdomains** allow for verification via the **CNAME** record.

#### Apex Domains

You can configure apex domains either through the **Nameservers** or **ANAME** methods.

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/configure-apex-domain.png`}
  width={1350 / 2}
  height={984 / 2}
  shadow
/>
<Caption>Instructions on configuring an <strong>apex domain</strong> from the Project Domains page.</Caption>

#### Subdomains

You can configure subdomains either through the **Nameservers** or **CNAME** methods.

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/configure-subdomain.png`}
  width={1350 / 2}
  height={984 / 2}
  shadow
/>
<Caption>Instructions on configuring a <strong>subdomain</strong> from the Project Domains page.</Caption>

### Step 5: Domain Configured

Once the domain has been configured, the card status will change to reflect this.

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/configured-domain.png`}
  width={1350 / 2}
  height={210 / 2}
  shadow
/>
<Caption>A configured domain on the Project Domains page.</Caption>

## Wildcard Domains

You can use your custom domain as a Wildcard Domain by prefixing it with `*.`.

<Note type="warning">
  If using your custom domain as a Wildcard Domain, you{' '}
  <b>must use the nameservers method for verification</b>.
</Note>

To add a Wildcard Domain, follow the steps to [add a domain](#step-1:-selecting-your-project), the only change being; at [step 3](#step-3:-entering-your-chosen-domain), where you should instead use the prefix mentioned above, for example; `*.acme.com`.

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/wildcard-domain.png`}
  width={1350 / 2}
  height={532 / 2}
  shadow
/>
<Caption>A <b>Wildcard Domain</b> awaiting verification.</Caption>

After the verification process is complete, the status of the domain will be updated within the UI to confirm that it is ready for use.

## Deploying with Your Domain

Once the domain has been added to your project and configured, it is **automatically applied to your latest deployment**.

If you want to update your production deployment, there are two options available, [using Now CLI](#using-now-cli) or [with Git](#with-git).

<Note>
  The first successful deployment of a new project will be marked as production
  and subsequently assigned with your custom domain automatically if you have
  used one of the following methods.
</Note>

### Using Now CLI

To update your production deployment, you can use the `--prod` argument with the [`now` command](/docs/now-cli/#commands/now) in your terminal:

<Snippet dark text="now --prod" />
<Caption>Deploying a project to production.</Caption>

### With Git

When a custom domain is assigned as a production domain to a project with a [Now for Git integration](/docs/v2/git-integration) enabled, each push (including merges) to the default branch (commonly `master`) will trigger a deployment to the defined domain.

Reverts take effect immediately, assigning the custom domain to the deployment made prior to the point the revert is effective from.

## Redirecting Domains

You can add domain redirects from the **Domains** tab when more than one domain is present for the project. This provides a way to, for example, redirect a `www` subdomain to an apex domain but can be used in a variety of ways.

To add a redirect, select the domain you want to redirect to from the **Redirect to** dropdown:

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/redirecting-domains.png`}
  width={1398 / 2.1}
  height={642 / 2.1}
  shadow
/>
<Caption>A <b>domain redirect</b> that redirects requests made to <InlineCode>www.zeit.rocks</InlineCode> to <InlineCode>zeit.rocks</InlineCode>.</Caption>

## Assigning a Domain to a Git Branch

Every commit pushed to the default branch of your Git repository using our [Git integration](/docs/v2/git-integration) will be assigned the Domains [configured in your project](#adding-a-domain).

In order to automatically assign a Domain to a different branch, you can select it in the **Git Branch** dropdown of your Domain:

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/branch-domains.png`}
  width={1398 / 2.1}
  height={640 / 2.1}
  shadow
/>
<Caption>A Domain that is automatically assigned to the <InlineCode>staging</InlineCode> <b>Git Branch</b>.</Caption>

## Removing a Domain

To remove a domain that is assigned to a project, navigate to the **Domains** tab from the Project Overview and click the **Edit** button for the domain you want to remove:

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/edit-domain.png`}
  width={1400 / 2.1}
  height={218 / 2.1}
  shadow
/>
<Caption>A configured domain on the Project Domains page with the option to edit.</Caption>

Once the **Edit** button has been clicked, you will be presented with further options. Click the **Remove** button to remove the domain from the project:

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/remove-domain.png`}
  width={1400 / 2.1}
  height={642 / 2.1}
  shadow
/>
<Caption>A configured domain on the Project Domains page with the option to remove.</Caption>

## Moving a Domain

If you own a domain, you can move it to another account or team in which you are a member using [Now CLI](https://zeit.co/docs/now-cli#commands/domains/extended-usage).

## Related

For more information on what to do next, we recommend the following article:

<Card
  title="Transferring Your Domain"
  href="/guides/transferring-domains-to-zeit-now"
>
  Learn how to transfer a domain to ZEIT Now.
</Card>

<Card
  title="Serverless Functions"
  href="/docs/v2/serverless-functions/introduction"
>
  Extend the capabilities of your project by adding Serverless Functions to it.
</Card>

export default ({ children }) => <Doc meta={meta}>{children}</Doc>

export const config = {
  amp: 'hybrid'
}
