import Doc from '~/components/layout/docs'
import Caption from '~/components/text/caption'
import { InlineCode, Code } from '~/components/text/code'
import Example from '~/components/example'
import { GenericLink } from '~/components/text/link'

export const meta = {
  title: 'Builders Overview',
  description:
    'A look at what Builders are and how they are used with ZEIT Now deployment Builds to achieve production-ready outputs.'
}

Builders are modules that take a deployment's source and return an output, consisting of [either static files or dynamic Lambdas](/docs/v2/deployments/builds#sources-and-outputs).

## When to Use Builders

If your project has source files that require transformation to be served to users, Builders enable this ability when deploying.

Whether [HTML files need to be minified](/docs/v2/deployments/official-builders/html-minifier-now-html-minifier), or dynamic content such as a [Node](/docs/v2/deployments/official-builders/node-js-now-node), [PHP](/docs/v2/deployments/official-builders/php-now-php), or [Go](/docs/v2/deployments/official-builders/go-now-go) app, need to be deployed, Builders offer the [flexibility and availability](/docs/v2/deployments/builders/developer-guide) needed to reach that goal.

## How to Use Builders

Builders can be used with Now by creating a `now.json` file in a project and then [using a `builds` property](/docs/v2/deployments/builds) within that configuration:

```json
{
  "builds": [
    { "src": "*.html", "use": "@now/static" },
    { "src": "date.js", "use": "@now/node" }
  ]
}
```

The `builds` property is an array of objects where each object is a build step, including a `src` and a `use` property, at least.

The Builder will receive a list of files based on the `src` property's [glob](<https://en.wikipedia.org/wiki/Glob_(programming)>) value.

## Developing your Own Builder

Extending the feature-set of a Now deployment is as simple as creating a Builder that, as previously mentioned, takes a list of files and outputs either static files or dynamic [Lambdas](/docs/v2/deployments/concepts/lambdas).

[A full API reference is available to help with creating Builders.](/docs/v2/deployments/builders/developer-guide)

## Technical Details

### Caching Data

A builder can retain an archive of up to `100mb` of the filesystem at `build` time. The cache key is generated as a combination of:

- Deployment `name` (i.e., the app name)
- Team id or user id
- Entrypoint path (e.g., `api/users/index.go`)
- Builder identifier including version (e.g.: `@now/go@0.0.1`)

The cache will be invalidated if any of those items changes. The user can bypass the cache by running `now -f`.

### Limits

- Builders can run for a maximum of 15 minutes before the execution times out.
- The maximum cache archive size of a Builder is 100mb.
- The cache TTL is 7 days.
- Default lambda bundled output size is **5mb**, however, [configurable](#configuring-lambda-bundle-size).

#### Configuring Lambda Bundle Size

Each lambda output, by default, has a bundle size limit of **5mb** to [help keep cold boot times low](/docs/v2/deployments/concepts/lambdas#maximum-bundle-size), but can be configured up to **50mb** with the [`maxLambdaSize` config option](/docs/v2/deployments/concepts/lambdas#maximum-bundle-size).

The lambda threshold can also be defined by the builder that outputs the lambda (for example, [@now/go, by default, is **15mb**](/docs/v2/deployments/official-builders/go-now-go#maximum-lambda-bundle-size)), but the user configuration takes precedence.

<Example>
  <Code lang="json">{`{
  "builds": [
    { "src": "*.go", "use": "@now/go", "config": { "maxLambdaSize": "20mb" } }
  ]
}`}</Code>
  <Caption>
    Using the{' '}
    <GenericLink href="/docs/v2/deployments/official-builders/go-now-go">
      @now/go Builder
    </GenericLink>{' '}
    and configuring the <InlineCode>maxLambdaSize</InlineCode> within a{' '}
    <GenericLink href="/docs/v2/deployments/configuration#builds">
      now.json configuration file
    </GenericLink>
    .
  </Caption>
</Example>

export default ({ children }) => <Doc meta={meta}>{children}</Doc>
